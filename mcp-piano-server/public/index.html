<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="88-Key Piano Interface - Play and control piano through MCP"
    />
    <title>MCP Piano - 88 Key Interface</title>
    <link rel="stylesheet" href="css/piano.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Header with connection status and controls -->
    <header class="piano-header">
      <div class="header-content">
        <h1 class="piano-title">MCP Piano</h1>
        <div class="connection-status">
          <div class="status-indicator" id="connectionStatus">
            <div class="status-dot"></div>
            <span class="status-text">Connecting...</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Main piano container -->
    <main class="piano-container">
      <!-- Piano controls panel -->
      <div class="controls-panel">
        <!-- Master Volume Control -->
        <div class="control-group">
          <label for="volumeControl">Master Volume</label>
          <input
            type="range"
            id="volumeControl"
            min="0"
            max="100"
            value="75"
            class="volume-slider"
          />
          <span class="volume-value">75%</span>
        </div>

        <!-- Octave Control -->
        <div class="control-group">
          <label for="octaveControl">Octave</label>
          <select id="octaveControl" class="octave-selector">
            <option value="2">C2-B2</option>
            <option value="3">C3-B3</option>
            <option value="4" selected>C4-B4</option>
            <option value="5">C5-B5</option>
            <option value="6">C6-B6</option>
          </select>
        </div>

        <!-- Sustain Pedal Control -->
        <div class="control-group">
          <label for="sustainToggle">Sustain Pedal</label>
          <button
            id="sustainToggle"
            class="sustain-button"
            aria-label="Toggle sustain pedal"
            title="Hold notes after key release"
          >
            <span class="sustain-icon">ðŸŽµ</span>
            <span class="sustain-text">Off</span>
          </button>
        </div>

        <!-- Audio Engine Status -->
        <div class="control-group">
          <label>Audio Engine</label>
          <div class="audio-status-indicator" id="audioStatus">
            <div class="audio-status-dot"></div>
            <span class="audio-status-text">Initializing...</span>
          </div>
        </div>

        <!-- Sample Loading Progress -->
        <div class="control-group" id="sampleLoadingGroup">
          <label>Sample Loading</label>
          <div class="sample-progress-container">
            <div class="sample-progress-bar">
              <div class="sample-progress-fill" id="sampleProgressFill"></div>
            </div>
            <span class="sample-progress-text" id="sampleProgressText">0%</span>
          </div>
        </div>
      </div>

      <!-- Piano keyboard canvas container -->
      <div class="piano-keyboard-container">
        <div class="piano-canvas-wrapper">
          <canvas
            id="pianoKeyboard"
            class="piano-canvas"
            role="application"
            aria-label="88-key piano keyboard interface"
            tabindex="0"
          ></canvas>

          <!-- Fallback SVG for older browsers -->
          <svg
            id="pianoKeyboardSVG"
            class="piano-svg hidden"
            role="application"
            aria-label="88-key piano keyboard interface"
            tabindex="0"
          >
            <!-- SVG piano keys will be generated by JavaScript -->
          </svg>
        </div>
      </div>

      <!-- Key mapping display -->
      <div class="key-mapping-display">
        <h3>Keyboard Shortcuts</h3>
        <div class="key-mapping-grid">
          <div class="key-map-item"><kbd>A</kbd> â†’ <span>C</span></div>
          <div class="key-map-item"><kbd>W</kbd> â†’ <span>C#</span></div>
          <div class="key-map-item"><kbd>S</kbd> â†’ <span>D</span></div>
          <div class="key-map-item"><kbd>E</kbd> â†’ <span>D#</span></div>
          <div class="key-map-item"><kbd>D</kbd> â†’ <span>E</span></div>
          <div class="key-map-item"><kbd>F</kbd> â†’ <span>F</span></div>
          <div class="key-map-item"><kbd>T</kbd> â†’ <span>F#</span></div>
          <div class="key-map-item"><kbd>G</kbd> â†’ <span>G</span></div>
          <div class="key-map-item"><kbd>Y</kbd> â†’ <span>G#</span></div>
          <div class="key-map-item"><kbd>H</kbd> â†’ <span>A</span></div>
          <div class="key-map-item"><kbd>U</kbd> â†’ <span>A#</span></div>
          <div class="key-map-item"><kbd>J</kbd> â†’ <span>B</span></div>
        </div>
      </div>
    </main>

    <!-- Footer with additional info -->
    <footer class="piano-footer">
      <div class="footer-content">
        <p>&copy; 2024 MCP Piano Interface | 88 Keys | Real Piano Layout</p>
        <div class="footer-links">
          <button id="fullscreenToggle" class="footer-button">
            Fullscreen
          </button>
          <button id="helpToggle" class="footer-button">Help</button>
        </div>
      </div>
    </footer>

    <!-- Help modal -->
    <div id="helpModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Piano Interface Help</h2>
          <button class="modal-close" id="closeHelp">&times;</button>
        </div>
        <div class="modal-body">
          <h3>How to Play</h3>
          <ul>
            <li>Click on piano keys with your mouse</li>
            <li>Use keyboard shortcuts (A-J keys map to C-B notes)</li>
            <li>Touch and drag on mobile devices</li>
            <li>Use the volume slider to adjust sound level</li>
            <li>Toggle sustain pedal for extended notes</li>
          </ul>

          <h3>Features</h3>
          <ul>
            <li>88-key full piano layout (A0 to C8)</li>
            <li>Multi-touch support on touch devices</li>
            <li>Real-time connection status</li>
            <li>Responsive design for all screen sizes</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- JavaScript -->
    <script src="https://unpkg.com/tone@latest"></script>
    <script src="js/audio-engine.js"></script>
    <script src="js/simple-websocket-client.js"></script>
    <script src="js/piano.js"></script>
    <script>
      // Initialize Piano Interface
      document.addEventListener("DOMContentLoaded", function () {
        console.log("ðŸŽ¹ Initializing Piano Interface...");

        // Initialize piano interface
        const piano = new PianoInterface();

        // Make objects globally available for debugging
        window.piano = piano;

        console.log("âœ… Piano Interface initialized");
      });
    </script>
  </body>
</html>
